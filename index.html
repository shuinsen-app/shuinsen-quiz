<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡†é™¢é¸ã‚¯ã‚¤ã‚º - ã©ã“ã®é¸æŒ™åŒºï¼Ÿ</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app">
    <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
    <div v-if="screen === 'title'" class="screen title-screen">
      <h1>ğŸ—³ï¸ è¡†é™¢é¸ã‚¯ã‚¤ã‚º</h1>
      <p class="subtitle">å††ã‚°ãƒ©ãƒ•ã‚’è¦‹ã¦ã€ã©ã“ã®é¸æŒ™åŒºã‹å½“ã¦ã‚ˆã†ï¼</p>
      <p class="rules">åˆ¶é™æ™‚é–“20ç§’ / å…¨10å• / 1å•æœ€å¤§10ç‚¹</p>
      <div class="mode-select">
        <div class="mode-card" @click="startGame('beginner')">
          <div class="mode-icon">ğŸ“—</div>
          <div class="mode-title">åˆç´šç·¨</div>
          <div class="mode-desc">åŒ—æµ·é“ãƒ»æ±äº¬ãƒ»æ„›çŸ¥ãƒ»å¤§é˜ªãƒ»ç¦å²¡</div>
          <div class="mode-count">å…¨88é¸æŒ™åŒºã‹ã‚‰å‡ºé¡Œ</div>
        </div>
        <div class="mode-card mode-card-advanced" @click="startGame('advanced')">
          <div class="mode-icon">ğŸ“•</div>
          <div class="mode-title">ä¸Šç´šç·¨</div>
          <div class="mode-desc">å…¨å›½47éƒ½é“åºœçœŒ</div>
          <div class="mode-count">å…¨289é¸æŒ™åŒºã‹ã‚‰å‡ºé¡Œ</div>
        </div>
      </div>
      <button @click="showRanking()" class="btn btn-ranking">
        ãƒ©ãƒ³ã‚­ãƒ³ã‚°
      </button>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
    <div v-if="screen === 'quiz'" class="screen quiz-screen">
      <div class="quiz-header">
        <span class="mode-badge">{{ modeLabel }}</span>
        <span class="question-count">å•é¡Œ {{ currentQuestion + 1 }} / {{ totalQuestions }}</span>
        <span class="score">ã‚¹ã‚³ã‚¢: {{ score.toFixed(2) }}</span>
      </div>

      <!-- ã‚¿ã‚¤ãƒãƒ¼ãƒãƒ¼ -->
      <div class="timer-container">
        <div class="timer-bar" :style="{ width: timerWidth + '%', backgroundColor: timerColor }"></div>
        <span class="timer-text" :style="{ color: timerColor }">{{ timerDisplay }}ç§’</span>
      </div>

      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>

      <div class="legend">
        <div v-for="(item, index) in getResultsFromCandidates(currentDistrict.candidates)" :key="index" class="legend-item">
          <span class="legend-color" :style="{ backgroundColor: getPartyColor(item.party) }"></span>
          <span class="legend-label">{{ item.party }} ({{ item.percentage }}%)</span>
        </div>
      </div>

      <!-- 4æŠãƒœã‚¿ãƒ³ -->
      <div class="choices">
        <button 
          v-for="choice in choices" 
          :key="choice.id"
          @click="selectAnswer(choice)"
          :class="['choice-btn', getChoiceClass(choice)]"
          :disabled="answered"
        >
          {{ choice.name }}
        </button>
      </div>

      <!-- çµæœè¡¨ç¤º -->
      <div v-if="answered" class="result-display">
        <div :class="['result-text', isCorrect ? 'correct' : 'incorrect']">
          {{ isCorrect ? 'æ­£è§£ï¼ğŸ‰' : (timeLeft <= 0 ? 'æ™‚é–“åˆ‡ã‚Œ...' : 'ä¸æ­£è§£...') }}
        </div>
        <div class="score-detail">
          <span v-if="isCorrect">+{{ questionScore.toFixed(2) }}ç‚¹</span>
          <span v-else>+0ç‚¹</span>
          <span class="answer-time">({{ answerTime.toFixed(2) }}ç§’)</span>
        </div>
        <div class="correct-answer">
          æ­£è§£: <strong>{{ currentDistrict.name }}</strong>
        </div>
        
        <!-- å€™è£œè€…ä¸€è¦§è¡¨ -->
        <div class="candidates-table-container">
          <table class="candidates-table">
            <thead>
              <tr>
                <th>å€™è£œè€…å</th>
                <th>æ”¿å…š</th>
                <th>å¾—ç¥¨æ•°</th>
                <th>å¾—ç¥¨ç‡</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(candidate, index) in currentDistrict.candidates" :key="index">
                <td>{{ candidate.name }}</td>
                <td>
                  <span class="party-badge" :style="{ backgroundColor: getPartyColor(candidate.party) }">
                    {{ candidate.party }}
                  </span>
                </td>
                <td class="votes">{{ formatNumber(candidate.votes) }}ç¥¨</td>
                <td class="percentage">{{ calculatePercentage(candidate.votes, currentDistrict.candidates) }}%</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <button @click="nextQuestion" class="btn btn-next">
          {{ currentQuestion + 1 < totalQuestions ? 'æ¬¡ã®å•é¡Œã¸' : 'çµæœã‚’è¦‹ã‚‹' }}
        </button>
      </div>
    </div>

    <!-- çµæœç”»é¢ -->
    <div v-if="screen === 'result'" class="screen result-screen">
      <h2>ğŸ† çµæœç™ºè¡¨</h2>
      <div class="final-score">
        <div class="score-number">{{ score.toFixed(2) }}</div>
        <div class="score-max">/ {{ totalQuestions * 10 }} ç‚¹</div>
      </div>
      <div class="result-message">{{ getResultMessage() }}</div>
      
      <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç™»éŒ² -->
      <div v-if="showNameInput" class="name-input-container">
        <p>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ</p>
        <input 
          type="text" 
          v-model="playerName" 
          placeholder="åå‰ã‚’å…¥åŠ›" 
          maxlength="20"
          class="name-input"
          @keyup.enter="submitScore"
        >
        <button @click="submitScore" class="btn btn-submit-score">ç™»éŒ²ã™ã‚‹</button>
      </div>
      
      <div v-else class="ranking-registered">
        âœ… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã—ã¾ã—ãŸï¼
      </div>
      
      <div class="result-buttons">
        <button @click="startGame()" class="btn btn-retry">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ï¼ˆ{{ modeLabel }}ï¼‰</button>
        <button @click="showRanking()" class="btn btn-show-ranking">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
        <button @click="screen = 'title'" class="btn btn-home">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
      </div>
    </div>

    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»é¢ -->
    <div v-if="screen === 'ranking'" class="screen ranking-screen">
      <h2>ğŸ… ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
      
      <div class="ranking-mode-tabs">
        <button @click="showRanking('beginner')" :class="['tab-btn', gameMode === 'beginner' ? 'active' : '']">åˆç´šç·¨</button>
        <button @click="showRanking('advanced')" :class="['tab-btn', gameMode === 'advanced' ? 'active' : '']">ä¸Šç´šç·¨</button>
      </div>
      
      <div v-if="ranking.length === 0" class="no-ranking">
        ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“
      </div>
      
      <table v-else class="ranking-table">
        <thead>
          <tr>
            <th>é †ä½</th>
            <th>åå‰</th>
            <th>ã‚¹ã‚³ã‚¢</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(entry, index) in ranking" :key="index" :class="{ 'top-three': index < 3 }">
            <td class="rank">
              <span v-if="index === 0">ğŸ¥‡</span>
              <span v-else-if="index === 1">ğŸ¥ˆ</span>
              <span v-else-if="index === 2">ğŸ¥‰</span>
              <span v-else>{{ index + 1 }}</span>
            </td>
            <td class="name">{{ entry.name }}</td>
            <td class="entry-score">{{ entry.score.toFixed(2) }}</td>
          </tr>
        </tbody>
      </table>
      
      <div class="ranking-buttons">
        <button @click="screen = 'title'" class="btn btn-home">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
      </div>
    </div>
  </div>

  <script src="js/partyColors.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
